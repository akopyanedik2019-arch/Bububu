<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Юпитер - Легкая версия</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; overflow: hidden; height: 100vh; }
        #container { width: 100%; height: 100%; }
        .loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; display: flex; justify-content: center;
            align-items: center; color: #ff9a3c; flex-direction: column;
            z-index: 1000;
        }
        .loading.hidden { opacity: 0; pointer-events: none; transition: 1s; }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div>Загрузка упрощенной версии...</div>
    </div>
    <div id="container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // Упрощенная конфигурация
        const CONFIG = {
            quality: 'medium',
            tapCountForExplosion: 50,  // Меньше тапов для взрыва
            particleCount: 1000,        // Меньше частиц
            enableBloom: false          // Без постобработки
        };

        let scene, camera, renderer, jupiter;
        let tapCount = 0;
        let isExploded = false;

        function init() {
            // Базовая сцена
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000010);
            
            // Камера
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 15);
            
            // Рендерер без антиалиасинга для экономии
            renderer = new THREE.WebGLRenderer({ 
                antialias: false,
                powerPreference: "low-power"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(1); // Фиксированный пиксель-ратио
            document.getElementById('container').appendChild(renderer.domElement);
            
            // Создаем объекты
            createSimpleStars();
            createSimpleJupiter();
            createSimpleLighting();
            
            // События
            setupSimpleEvents();
            
            // Загрузка
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 1000);
            
            animate();
        }
        
        function createSimpleStars() {
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(CONFIG.particleCount * 3);
            
            for(let i = 0; i < CONFIG.particleCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 1000;
                positions[i + 1] = (Math.random() - 0.5) * 1000;
                positions[i + 2] = (Math.random() - 0.5) * 1000;
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const material = new THREE.PointsMaterial({ 
                size: 1.5, 
                color: 0xFFFFFF 
            });
            
            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }
        
        function createSimpleJupiter() {
            const geometry = new THREE.SphereGeometry(4, 32, 32);
            
            // Простая текстура
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            gradient.addColorStop(0, '#FFB347');
            gradient.addColorStop(0.5, '#E68A2E');
            gradient.addColorStop(1, '#CC6E1D');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Простые полосы
            ctx.strokeStyle = 'rgba(139, 69, 19, 0.8)';
            ctx.lineWidth = 10;
            for(let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * 50 + 20);
                ctx.lineTo(canvas.width, i * 50 + 20);
                ctx.stroke();
            }
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.MeshBasicMaterial({ map: texture });
            
            jupiter = new THREE.Mesh(geometry, material);
            scene.add(jupiter);
        }
        
        function createSimpleLighting() {
            const light = new THREE.DirectionalLight(0xFFFFFF, 1);
            light.position.set(10, 5, 5);
            scene.add(light);
            
            const ambient = new THREE.AmbientLight(0x333333);
            scene.add(ambient);
        }
        
        function setupSimpleEvents() {
            renderer.domElement.addEventListener('click', (e) => {
                if (isExploded) return;
                
                tapCount++;
                console.log(`Тап ${tapCount}/50`);
                
                if (tapCount >= CONFIG.tapCountForExplosion) {
                    explodeSimpleJupiter();
                }
            });
            
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
        
        function explodeSimpleJupiter() {
            isExploded = true;
            
            // Создаем взрывной текст
            const text = document.createElement('div');
            text.textContent = 'sosat bibijon❤️';
            text.style.position = 'fixed';
            text.style.top = '50%';
            text.style.left = '50%';
            text.style.transform = 'translate(-50%, -50%)';
            text.style.color = '#ff0000';
            text.style.fontSize = '48px';
            text.style.fontWeight = 'bold';
            text.style.zIndex = '1000';
            document.body.appendChild(text);
            
            // Удаляем Юпитер
            scene.remove(jupiter);
            
            // Восстанавливаем через 3 секунды
            setTimeout(() => {
                text.remove();
                isExploded = false;
                tapCount = 0;
                createSimpleJupiter();
            }, 3000);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (jupiter && !isExploded) {
                jupiter.rotation.y += 0.005;
            }
            
            renderer.render(scene, camera);
        }
        
        // Проверка WebGL
        function checkWebGL() {
            try {
                const canvas = document.createElement('canvas');
                return !!(window.WebGLRenderingContext && 
                         (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
            } catch (e) {
                return false;
            }
        }
        
        if (checkWebGL()) {
            init();
        } else {
            document.getElementById('loading').innerHTML = 
                '<div style="color: #ff4444; text-align: center;">WebGL не поддерживается</div>';
        }
    </script>
</body>
</html>
