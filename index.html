<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>HTML 3D Race</title>
  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; background: #000; }
    #hud {
      position: fixed;
      top: 12px;
      left: 12px;
      color: #0f0;
      font-family: monospace;
      font-size: 14px;
      z-index: 10;
    }
  </style>
</head>
<body>
<div id="hud">Speed: 0</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
// ===== SCENE =====
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x000000, 30, 200);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 500);
camera.position.set(0, 4, 8);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ===== LIGHT =====
scene.add(new THREE.AmbientLight(0xffffff, 0.4));
const dirLight = new THREE.DirectionalLight(0xffffff, 1);
dirLight.position.set(5, 10, 7);
scene.add(dirLight);

// ===== TRACK =====
const track = new THREE.Group();
const trackMat = new THREE.MeshStandardMaterial({ color: 0x111111 });

for (let i = 0; i < 200; i++) {
  const segment = new THREE.Mesh(
    new THREE.BoxGeometry(10, 0.1, 10),
    trackMat
  );
  segment.position.z = -i * 10;
  track.add(segment);
}
scene.add(track);

// ===== CAR =====
const car = new THREE.Mesh(
  new THREE.BoxGeometry(1.5, 0.6, 3),
  new THREE.MeshStandardMaterial({ color: 0xff0000 })
);
car.position.y = 0.5;
scene.add(car);

// ===== CONTROLS =====
let speed = 0;
let maxSpeed = 1.2;
let accel = 0.02;
let turn = 0;

const keys = {};
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

// ===== MOBILE TOUCH CONTROLS =====
let touchX = null;
let touching = false;

window.addEventListener('touchstart', e => {
  touching = true;
  touchX = e.touches[0].clientX;
});

window.addEventListener('touchmove', e => {
  if (!touching) return;
  const dx = e.touches[0].clientX - touchX;
  turn = dx * 0.002;
});

window.addEventListener('touchend', () => {
  touching = false;
  turn = 0;
});

// ===== ANIMATION =====
function animate() {
  requestAnimationFrame(animate);

  if (keys['w']) speed = Math.min(maxSpeed, speed + accel);
  if (keys['s']) speed = Math.max(0, speed - accel * 2);
  if (!keys['w']) speed *= 0.98;

  if (keys['a']) turn += 0.03;
  if (keys['d']) turn -= 0.03;
  turn *= 0.9;

  car.position.x += turn;
  car.position.z -= speed;

  camera.position.x += (car.position.x - camera.position.x) * 0.05;
  camera.position.z += ((car.position.z + 8) - camera.position.z) * 0.1;
  camera.lookAt(car.position);

  document.getElementById('hud').innerText = `Speed: ${(speed * 100).toFixed(0)}`;

  renderer.render(scene, camera);
}

animate();

window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
